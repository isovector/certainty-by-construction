% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode$for(hyperrefoptions)$,$hyperrefoptions$$endfor$}{hyperref}
\PassOptionsToPackage{hyphens}{url}
$if(colorlinks)$
\PassOptionsToPackage{dvipsnames,svgnames,x11names}{xcolor}
$endif$
%
\documentclass[
$if(fontsize)$
  $fontsize$,
$endif$
$if(papersize)$
  $papersize$paper,
$endif$
$for(classoption)$
  $classoption$$sep$,
$endfor$
]{book}
\usepackage{amsmath,amssymb}
\usepackage{marvosym}
\usepackage{marginnote}
$if(linestretch)$
\usepackage{setspace}
$endif$
\usepackage{iftex}
\ifPDFTeX
  \usepackage[$if(fontenc)$$fontenc$$else$T1$endif$]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
$if(mathspec)$
  \ifXeTeX
    \usepackage{mathspec}
  \else
    \usepackage{unicode-math}
  \fi
$else$
  \usepackage{unicode-math}
$endif$
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
$if(zero-width-non-joiner)$
%% Support for zero-width non-joiner characters.
\makeatletter
\def\zerowidthnonjoiner{%
  % Prevent ligatures and adjust kerning, but still support hyphenating.
  \texorpdfstring{%
    \TextOrMath{\nobreak\discretionary{-}{}{\kern.03em}%
      \ifvmode\else\nobreak\hskip\z@skip\fi}{}%
  }{}%
}
\makeatother
\ifPDFTeX
  \DeclareUnicodeCharacter{200C}{\zerowidthnonjoiner}
\else
  \catcode`^^^^200c=\active
  \protected\def ^^^^200c{\zerowidthnonjoiner}
\fi
%% End of ZWNJ support
$endif$
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[$for(microtypeoptions)$$microtypeoptions$$sep$,$endfor$]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    % \usepackage{parskip}
  }{% else
    % \setlength{\parindent}{0pt}
    % \setlength{\parskip}{6pt plus 2pt minus 1pt}
    }
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
$if(verbatim-in-note)$
\usepackage{fancyvrb}
$endif$
\usepackage{xcolor}
\usepackage[paperwidth=6.25in,paperheight=9.25in,inner=2.5cm, outer=1.9cm, top=2.2cm, bottom=2cm]{geometry}
$if(listings)$
\usepackage{listings}
\newcommand{\passthrough}[1]{#1}
\lstset{defaultdialect=[5.3]Lua}
\lstset{defaultdialect=[x86masm]Assembler}
$endif$
$if(lhs)$
\lstnewenvironment{code}{\lstset{language=Haskell,basicstyle=\small\ttfamily}}{}
$endif$
$if(highlighting-macros)$
$highlighting-macros$
$endif$
\usepackage{longtable,booktabs,array}
$if(multirow)$
\usepackage{multirow}
$endif$
\usepackage{calc} % for calculating minipage widths
$if(beamer)$
$else$
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
$endif$
$if(graphics)$
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
$endif$
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{$if(secnumdepth)$$secnumdepth$$else$5$endif$}
$if(block-headings)$
% Make \paragraph and \subparagraph free-standing
\ifx\paragraph\undefined\else
  \let\oldparagraph\paragraph
  \renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
  \let\oldsubparagraph\subparagraph
  \renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi
$endif$
$if(pagestyle)$
\pagestyle{$pagestyle$}
$endif$
$if(csl-refs)$
\newlength{\cslhangindent}
\setlength{\cslhangindent}{1.5em}
\newlength{\csllabelwidth}
\setlength{\csllabelwidth}{3em}
\newlength{\cslentryspacingunit} % times entry-spacing
\setlength{\cslentryspacingunit}{\parskip}
\newenvironment{CSLReferences}[2] % #1 hanging-ident, #2 entry spacing
 {% don't indent paragraphs
  \setlength{\parindent}{0pt}
  % turn on hanging indent if param 1 is 1
  \ifodd #1
  \let\oldpar\par
  \def\par{\hangindent=\cslhangindent\oldpar}
  \fi
  % set entry spacing
  \setlength{\parskip}{#2\cslentryspacingunit}
 }%
 {}
\usepackage{calc}
\newcommand{\CSLBlock}[1]{#1\hfill\break}
\newcommand{\CSLLeftMargin}[1]{\parbox[t]{\csllabelwidth}{#1}}
\newcommand{\CSLRightInline}[1]{\parbox[t]{\linewidth - \csllabelwidth}{#1}\break}
\newcommand{\CSLIndent}[1]{\hspace{\cslhangindent}#1}
$endif$
$if(lang)$
\ifLuaTeX
\usepackage[bidi=basic]{babel}
\else
\usepackage[bidi=default]{babel}
\fi
$if(babel-lang)$
\babelprovide[main,import]{$babel-lang$}
$endif$
$for(babel-otherlangs)$
\babelprovide[import]{$babel-otherlangs$}
$endfor$
% get rid of language-specific shorthands (see #6817):
\let\LanguageShortHands\languageshorthands
\def\languageshorthands#1{}
$endif$
$for(header-includes)$
$header-includes$
$endfor$
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
$if(dir)$
\ifPDFTeX
  \TeXXeTstate=1
  \newcommand{\RL}[1]{\beginR #1\endR}
  \newcommand{\LR}[1]{\beginL #1\endL}
  \newenvironment{RTL}{\beginR}{\endR}
  \newenvironment{LTR}{\beginL}{\endL}
\fi
$endif$
$if(natbib)$
\usepackage[$natbiboptions$]{natbib}
\bibliographystyle{$if(biblio-style)$$biblio-style$$else$plainnat$endif$}
$endif$
$if(biblatex)$
\usepackage[$if(biblio-style)$style=$biblio-style$,$endif$$for(biblatexoptions)$$biblatexoptions$$sep$,$endfor$]{biblatex}
$for(bibliography)$
\addbibresource{$bibliography$}
$endfor$
$endif$
$if(nocite-ids)$
\nocite{$for(nocite-ids)$$it$$sep$, $endfor$}
$endif$
$if(csquotes)$
\usepackage{csquotes}
$endif$
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
$if(links-as-notes)$
% Make links footnotes instead of hotlinks:
\DeclareRobustCommand{\href}[2]{#2\footnote{\url{#1}}}
$endif$
$if(verbatim-in-note)$
\VerbatimFootnotes % allow verbatim text in footnotes
$endif$

$if(title)$
\title{$title$$if(thanks)$\thanks{$thanks$}$endif$}
$endif$
\usepackage{etoolbox}
\makeatletter
\providecommand{\subtitle}[1]{% add subtitle to \maketitle
  \apptocmd{\@title}{\par {\large #1 \par}}{}{}
}
\makeatother
\subtitle{$subtitle$}
\author{$for(author)$$author$$sep$ \and $endfor$}
\date{$date$}




% NOTE(sandy): here is where my stuff lives

\usepackage[fontsize=11pt]{fontsize}
\usepackage{tocbibind}
\usepackage{commath}
\usepackage{pifont}
\usepackage{sectsty}


\usepackage{listings}
\usepackage[many]{tcolorbox}
\tcbuselibrary{xparse}
\tcbuselibrary{listings}
\usepackage{titlesec}

\titleformat{\chapter}[display]
  {\bfseries\Large}
  {\filright\MakeUppercase{\chaptertitlename} \Huge\thechapter}
  {1ex}
  {\titlerule\vspace{0.7ex}\filleft\impact\huge}
  [\vspace{1ex}\titlerule]

% \titleformat{\chapter}[display]
%   {\normalsize \huge  \color{black}}%
%   {\flushright\normalsize%
%    \MakeUppercase{\chaptertitlename}\hspace{1ex}%
%    {\fontfamily{mdugm}\fontsize{60}{60}\selectfont\thechapter}}%
%   {10 pt}%
%   {\bfseries\huge}%

\newcommand{\hidestart}{}
\newcommand{\hideend}{}

\usepackage{comment}
\excludecomment{hidden}

\usepackage{contour}
\contourlength{0.001em}
\usepackage[conor]{tex/agda}

\setlength{\agdaindent}{0cm}

\usepackage{fontspec}

\usepackage{unicode-math}
\setsansfont[Scale=MatchLowercase]{Noto Sans Mono}
\setmathfont{XITS Math}
\setmonofont{Noto Sans Mono}
\setmainfont{MLMRoman10}

\colorlet{RED}{black}

\usepackage{ragged2e}
\usepackage{fvextra}

\usepackage{pdfpages}

\newlength\longest


\usepackage{fancyhdr}

% \makeatletter
% \renewcommand\normalsize{\@setfontsize\normalsize{14pt}{16pt}}
% \normalsize
% \makeatother


\makeatletter
\renewcommand*{\cleardoublepage}{\clearpage\if@twoside \ifodd\c@page\else
\hbox{}%
\thispagestyle{empty}%
\newpage%
\if@twocolumn\hbox{}\newpage\fi\fi\fi}
\makeatother



\usepackage{newunicodechar}
\usepackage[Latin,Greek]{ucharclasses}
\usepackage{tikz}
\usetikzlibrary{calc}
\usepackage[thmmarks, amsmath, thref]{ntheorem}
% \newfontface{\libertinus}{FreeSans}
% \newfontface{\monospacefont}{Inconsolata}


\newfontfamily{\iosevka}{Iosevka}
\newunicodechar{‚¶Ç}{\iosevka{}‚¶Ç}
\newunicodechar{‚ÇÅ}{\iosevka{}‚ÇÅ}
\newunicodechar{‚Ñì}{\iosevka{}‚Ñì}
\newunicodechar{‚Ü™}{\iosevka{}‚Ü™}
\newunicodechar{‚àé}{\iosevka{}‚àé}
\newunicodechar{‚â§}{\iosevka{}‚â§}
\newunicodechar{‚äù}{\iosevka{}‚äù}
\newunicodechar{‚¶É}{\iosevka{}‚¶É}
\newunicodechar{‚¶Ñ}{\iosevka{}‚¶Ñ}
\newunicodechar{‚®Ñ}{\iosevka{}‚®Ñ}
\newunicodechar{ùî∏}{\iosevka{}ùî∏}
\newunicodechar{‚â°}{\iosevka{}‚â°}
% \newunicodechar{‚à®}{\iosevka{}‚à®}
\newunicodechar{ ≥}{\iosevka{} ≥}
\allsectionsfont{\impact}

\newfontfamily{\substitutefont}[Scale=MatchLowercase]{Noto Sans}

\usepackage[tikz]{bclogo}
\renewcommand{\textunderscore}{\string_}

\newcommand{\BookEnv}[4]{\newenvironment{#1}{#2\begin{tcolorbox}[breakable, left=2.5mm, right=3mm, top=4mm, bottom=0mm, skin=enhancedmiddle, colframe=white, title={\color{black}#3\quad{}\impact{#4}}]\color{black}}{\end{tcolorbox}}}

\BookEnv{AgdaInfo}{}{\Info}{INFO WINDOW}
\BookEnv{Footgun}{}{\Radioactivity}{CAUTION}
\newenvironment{UnicodeTable}{\spaceMyBox\begin{tcolorbox}[breakable, left=2.5mm, right=3mm, top=4mm, bottom=0mm,
skin=enhancedmiddle, colback=white, colframe=white, title={\color{black}\Keyboard\quad{}\impact{UNICODE IN THIS CHAPTER}}]\color{black}}{\end{tcolorbox}}


\newfontfamily{\impact}{SofiaSansCondensed-Medium}

\pagestyle{fancy}
\setlength{\headheight}{18.71pt}
\renewcommand{\headrulewidth}{0pt}
% \renewcommand{\headrulewidth}{0pt}
% \renewcommand{\footrulewidth}{0pt}
\fancyhead[LE]{\large\impact\thepage}
\fancyhead[LO]{\large\impact\rightmark}
\fancyhead[RO]{\large\impact\thepage}
\fancyhead[RE]{\large\impact\leftmark}
% \fancyfoot[C]{\footnotesize revision \texttt{\input{.current-revision}}}
\fancyfoot{}

\newcommand{\agdainput}[1]{\tcbox[enhanced, box align=base, nobeforeafter, colframe=black, size=small, boxsep=2pt]{#1}}

\newcommand{\AgdaCmd}[1]{{\tt#1}}
\newcommand{\AgdaEmacsInput}[1]{ (\agdainput{\tt #1} in Emacs and VS Code)}
\newcommand{\AgdaCmdArg}[1]{ with argument {\AgdaHole{#1}}}
\newcommand{\AgdaCmdNoArg}[1]{ without any argument}
\newcommand{\agdamode}[1]{\tcbox[enhanced, box align=base, nobeforeafter, colframe=black, size=small, boxsep=2pt]{\tt \textbackslash{#1}}}

\newcommand{\anncirc}[1]{\raisebox{-0.5mm}{\tikz\node[text=white,
font=\sffamily\bfseries,minimum size=2mm,inner sep=0mm,draw,circle,fill=black]
{\small #1};}}

\newcommand{\ann}[1]{\anncirc{#1}}
\newcommand{\annotate}[1]{\Lawfill\quad\anncirc{#1}\qquad}

\makeatletter{}
\newcommand{\Dotfill}{\leavevmode \cleaders \hb@xt@.85em{\ensuremath{\hss
\cdot\hss}}
\hfill \kern \z@}

\newcommand{\Lawfill}{\leavevmode \cleaders \hb@xt@2em{\hss}
\hfill \kern \z@}
\makeatother{}


\theoremprework{%
\setlength\theorempreskipamount{1ex}\setlength\theorempostskipamount{2ex}
}

\theoremstyle{nonumberplain}
\theoremheaderfont{\itshape}
\theorembodyfont{\upshape}
\theoremseparator{.}
\theoremsymbol{\ensuremath{\square}}
\newtheorem{exercise}{Exercise}

\usepackage{etoolbox}
\usepackage{xstring}
% \setlength{\aboverulesep}{0pt}
% \setlength{\belowrulesep}{0pt}
\renewcommand{\arraystretch}{1.3}
\makeatletter
% \patchcmd{\LT@array}{\@mkpream{#2}}{%
% \StrGobbleLeft{#2}{2}[\pream]%
% \StrGobbleRight{\pream}{2}[\pream]%
% \StrSubstitute{\pream}{l}{|l}[\pream]%
% \StrSubstitute{\pream}{c}{|c}[\pream]%
% \StrSubstitute{\pream}{r}{|r}[\pream]%
% \@mkpream{@{}\pream|@{}}%
% }{}{}

\long\def\@mn@@@marginnote[#1]#2[#3]{%
  \begingroup
    \ifmmode\mn@strut\let\@tempa\mn@vadjust\else
      \if@inlabel\leavevmode\fi
      \ifhmode\mn@strut\let\@tempa\mn@vadjust\else\let\@tempa\mn@vlap\fi
    \fi
    \@tempa{%
      \vbox to\z@{%
        \vss
        \@mn@margintest
        \if@reversemargin\if@tempswa
            \@tempswafalse
          \else
            \@tempswatrue
        \fi\fi

          \llap{%
            \vbox to\z@{\kern\marginnotevadjust\kern #3
              \vbox to\z@{%
                \hsize\marginparwidth
                \linewidth\hsize
                \kern-\parskip
                %\mn@parboxrestore
                \marginfont\raggedleftmarginnote\strut\hspace{\z@}%
                \ignorespaces#1\endgraf
                \vss
              }%
              \vss
            }%
            \if@mn@verbose
              \PackageInfo{marginnote}{xpos seems to be \@mn@currxpos}%
            \fi
            \begingroup
              \ifx\@mn@currxpos\relax\else\ifx\@mn@currpos\@empty\else
                  \kern\@mn@currxpos
              \fi\fi
              \ifx\@mn@currpage\relax
                \let\@mn@currpage\@ne
              \fi
              \if@twoside\ifodd\@mn@currpage\relax
                  \kern-\oddsidemargin
                \else
                  \kern-\evensidemargin
                \fi
              \else
                \kern-\oddsidemargin
              \fi
              \kern-1in
            \endgroup
            \kern\marginparsep
          }%
      }%
    }%
  \endgroup
  }

\makeatother

\usepackage{float}
\floatplacement{figure}{H}

\begin{document}
$if(has-frontmatter)$
$if(wants-cover)$
\thispagestyle{empty}
\includepdf[fitpaper]{../art/cover}
\thispagestyle{empty}

\clearpage
\thispagestyle{empty}
\quad
$endif$
\frontmatter
$endif$
$if(title)$
\maketitle
$if(abstract)$
\begin{abstract}
$abstract$
\end{abstract}
$endif$
$endif$

$for(include-before)$
$include-before$

$endfor$

% NOTE(sandy): beginning of frontmatter stuff

\newcommand{\spaceMyBox}{\par\addvspace{7mm}}

\newcommand{\bigQuote}[2]{
\centering
\parbox{\longest}{%
  \raggedright{\Large%
   #2\par\bigskip
  }
  \raggedleft\Large\MakeUppercase{#1}\par%
}
}

\title{Certainty by Construction}
\subtitle{Software \& Mathematics in Agda}
\author{Sandy Maguire}
\maketitle

\thispagestyle{empty}
\null\vfill

\raggedright

{\small
Cofree Press

\quad

First published 2023

\quad

Copyright \textcopyright\;2023, Sandy Maguire

All rights reserved.

\quad

Version 1.0.9 / 2024-01-15

}

\justify

\clearpage
\thispagestyle{empty}
\newcommand{\dedicationname}{Dedication}
\pdfbookmark{\dedicationname}{dedication}

\null\vfill
\begin{center}
{\large To Erin Jackes,} \\
{\small who knows the true meaning of equality}
\end{center}
\vfill
\vfill
\vfill

\clearpage


\thispagestyle{empty}

\clearpage
\newcommand{\quotename}{Quote}
\pdfbookmark{\quotename}{quote}
\thispagestyle{empty}
\null\vfill


\settowidth\longest{\Large In science if you know what you are}
\bigQuote{Richard Hamming}{
  In science if you know what you are\\
  doing you should not be doing it.\\
  \quad\\
  In engineering if you do not know\\
  what you are doing you should not\\
  be doing it.
}

\justify

\vfill\vfill\vfill

% \tcbset{listing engine=listings}
% \tcbset{no listing options}

% NOTE(sandy): end

$if(toc)$
$if(toc-title)$
\renewcommand*\contentsname{$toc-title$}
$endif$
{
$if(colorlinks)$
\hypersetup{linkcolor=$if(toccolor)$$toccolor$$else$$endif$}
$endif$
\setcounter{tocdepth}{$toc-depth$}
\tableofcontents
}
$endif$
$if(lof)$
\listoffigures
$endif$
$if(lot)$
\listoftables
$endif$
$if(linestretch)$
\setstretch{$linestretch$}
$endif$
$if(has-frontmatter)$
\mainmatter
$endif$
$body$

$if(has-frontmatter)$
\backmatter
$endif$
$for(include-after)$
$include-after$

$endfor$
\end{document}
